{% doc %}
  @prompt
    Create a premium 3D e-commerce object slider for a Shopify store selling mobile accessories.
    The slider should display individual products as realistic 3D objects (headphones, earphones, fast chargers, adapters, cables, power banks) placed on modern floating pods or platforms.
    Visual & 3D Details:
    Strong 3D depth and perspective with realistic scale
    Products shown at dynamic angles (slight rotation, front-tilt, side-view)
    Soft ambient shadows beneath each object for floating effect
    Subtle reflections and light gradients to enhance realism
    Smooth parallax or rotation movemnt during slide change or hover
    Interactivity & UX:
    Each 3D product is clickable
    Click opens a product page or collection page
    Smooth horizontal slider with swipe support for mobile
    Hover effect: object slightly lifts, rotates, and glows
    Design Style:
    Clean, minimal background (light or dark) with blue tech accents
    Premium, futuristic, tech-inspired UI
    Clear focus on the product with no visual clutter
    Shopify Integration:
    Built as a custom Shopify section
    Option to add, remove, or reorder products from Shopify Customizer
    Each slide supports product image, title, and link
    Fully mobile-responsive and performance-optimize
    Overall Feel:
    High-end, modern, and professional
    Strong 3D presence that makes products feel bold and prominent
    Designed to increase engagement and clicks on mobile and desktop
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-3d-slider-{{ ai_gen_id }} {
    display: block;
    width: 100%;
    position: relative;
    overflow: hidden;
    padding: 60px 0;
    background: {{ block.settings.background_color }};
  }

  .ai-3d-slider-container-{{ ai_gen_id }} {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .ai-3d-slider-heading-{{ ai_gen_id }} {
    text-align: center;
    margin-bottom: 50px;
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.heading_size }}px;
  }

  .ai-3d-slider-track-wrapper-{{ ai_gen_id }} {
    position: relative;
    perspective: {{ block.settings.perspective }}px;
    perspective-origin: 50% 50%;
  }

  .ai-3d-slider-track-{{ ai_gen_id }} {
    display: flex;
    gap: 40px;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    transform-style: preserve-3d;
  }

  .ai-3d-slider-slide-{{ ai_gen_id }} {
    flex: 0 0 {{ block.settings.slide_width }}px;
    position: relative;
    transform-style: preserve-3d;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .ai-3d-slider-slide-{{ ai_gen_id }}.active {
    transform: scale(1.05) translateZ(50px);
  }

  .ai-3d-slider-pod-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    height: {{ block.settings.pod_height }}px;
    background: {{ block.settings.pod_color }};
    border-radius: {{ block.settings.pod_radius }}px;
    display: flex;
    align-items: center;
    justify-content: center;
    transform-style: preserve-3d;
    transition: all 0.4s ease;
    box-shadow: 
      0 20px 60px {{ block.settings.shadow_color }}40,
      0 10px 30px {{ block.settings.shadow_color }}20;
    overflow: hidden;
  }

  .ai-3d-slider-pod-{{ ai_gen_id }}::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
      135deg,
      {{ block.settings.accent_color }}10 0%,
      transparent 50%,
      {{ block.settings.accent_color }}05 100%
    );
    border-radius: {{ block.settings.pod_radius }}px;
    opacity: 0;
    transition: opacity 0.4s ease;
  }

  .ai-3d-slider-slide-{{ ai_gen_id }}:hover .ai-3d-slider-pod-{{ ai_gen_id }}::before {
    opacity: 1;
  }

  .ai-3d-slider-slide-{{ ai_gen_id }}:hover .ai-3d-slider-pod-{{ ai_gen_id }} {
    transform: translateY(-10px) rotateX({{ block.settings.hover_tilt }}deg);
    box-shadow: 
      0 30px 80px {{ block.settings.shadow_color }}50,
      0 15px 40px {{ block.settings.shadow_color }}30,
      0 0 0 2px {{ block.settings.accent_color }}40;
  }

  .ai-3d-slider-product-link-{{ ai_gen_id }} {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .ai-3d-slider-image-wrapper-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 30px;
    transform-style: preserve-3d;
  }

  .ai-3d-slider-image-{{ ai_gen_id }} {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    transform: rotateY({{ block.settings.product_rotation }}deg) rotateX({{ block.settings.product_tilt }}deg);
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    filter: drop-shadow(0 15px 30px {{ block.settings.shadow_color }}30);
  }

  .ai-3d-slider-slide-{{ ai_gen_id }}:hover .ai-3d-slider-image-{{ ai_gen_id }} {
    transform: rotateY({{ block.settings.product_rotation | plus: 5 }}deg) rotateX({{ block.settings.product_tilt | minus: 3 }}deg) scale(1.08);
  }

  .ai-3d-slider-reflection-{{ ai_gen_id }} {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 40%;
    background: linear-gradient(
      to top,
      {{ block.settings.pod_color }}00 0%,
      {{ block.settings.pod_color }}15 100%
    );
    pointer-events: none;
    opacity: {{ block.settings.reflection_opacity | divided_by: 100.0 }};
  }

  .ai-3d-slider-info-{{ ai_gen_id }} {
    text-align: center;
    margin-top: 20px;
    padding: 0 10px;
  }

  .ai-3d-slider-title-{{ ai_gen_id }} {
    font-size: {{ block.settings.product_title_size }}px;
    font-weight: 600;
    color: {{ block.settings.text_color }};
    margin-bottom: 8px;
    transition: color 0.3s ease;
  }

  .ai-3d-slider-slide-{{ ai_gen_id }}:hover .ai-3d-slider-title-{{ ai_gen_id }} {
    color: {{ block.settings.accent_color }};
  }

  .ai-3d-slider-price-{{ ai_gen_id }} {
    font-size: {{ block.settings.price_size }}px;
    color: {{ block.settings.text_color }}cc;
    font-weight: 500;
  }

  .ai-3d-slider-nav-{{ ai_gen_id }} {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 40px;
  }

  .ai-3d-slider-nav-btn-{{ ai_gen_id }} {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: {{ block.settings.nav_button_color }};
    border: 2px solid {{ block.settings.accent_color }}40;
    color: {{ block.settings.text_color }};
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px {{ block.settings.shadow_color }}20;
  }

  .ai-3d-slider-nav-btn-{{ ai_gen_id }}:hover {
    background: {{ block.settings.accent_color }};
    color: {{ block.settings.background_color }};
    transform: scale(1.1);
    box-shadow: 0 6px 20px {{ block.settings.accent_color }}40;
  }

  .ai-3d-slider-nav-btn-{{ ai_gen_id }}:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    transform: scale(1);
  }

  .ai-3d-slider-dots-{{ ai_gen_id }} {
    display: flex;
    gap: 10px;
  }

  .ai-3d-slider-dot-{{ ai_gen_id }} {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: {{ block.settings.text_color }}30;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .ai-3d-slider-dot-{{ ai_gen_id }}.active {
    background: {{ block.settings.accent_color }};
    width: 30px;
    border-radius: 5px;
  }

  .ai-3d-slider-empty-{{ ai_gen_id }} {
    text-align: center;
    padding: 80px 20px;
    color: {{ block.settings.text_color }}80;
    font-size: 16px;
  }

  @media screen and (max-width: 1024px) {
    .ai-3d-slider-slide-{{ ai_gen_id }} {
      flex: 0 0 300px;
    }

    .ai-3d-slider-pod-{{ ai_gen_id }} {
      height: 300px;
    }
  }

  @media screen and (max-width: 768px) {
    .ai-3d-slider-{{ ai_gen_id }} {
      padding: 40px 0;
    }

    .ai-3d-slider-slide-{{ ai_gen_id }} {
      flex: 0 0 250px;
    }

    .ai-3d-slider-pod-{{ ai_gen_id }} {
      height: 250px;
    }

    .ai-3d-slider-track-{{ ai_gen_id }} {
      gap: 20px;
    }

    .ai-3d-slider-heading-{{ ai_gen_id }} {
      font-size: {{ block.settings.heading_size | times: 0.7 }}px;
      margin-bottom: 30px;
    }

    .ai-3d-slider-nav-btn-{{ ai_gen_id }} {
      width: 40px;
      height: 40px;
    }
  }
{% endstyle %}

<product-3d-slider-{{ ai_gen_id }} class="ai-3d-slider-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-3d-slider-container-{{ ai_gen_id }}">
    {% if block.settings.heading != blank %}
      <h2 class="ai-3d-slider-heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
    {% endif %}

    {% assign has_products = false %}
    {% for i in (1..6) %}
      {% assign product_key = 'product_' | append: i %}
      {% if block.settings[product_key] != blank %}
        {% assign has_products = true %}
        {% break %}
      {% endif %}
    {% endfor %}

    {% if has_products %}
      <div class="ai-3d-slider-track-wrapper-{{ ai_gen_id }}">
        <div class="ai-3d-slider-track-{{ ai_gen_id }}" data-track>
          {% for i in (1..6) %}
            {% assign product_key = 'product_' | append: i %}
            {% assign product = block.settings[product_key] %}
            
            {% if product != blank %}
              <div class="ai-3d-slider-slide-{{ ai_gen_id }}" data-slide>
                <a href="{{ product.url }}" class="ai-3d-slider-product-link-{{ ai_gen_id }}">
                  <div class="ai-3d-slider-pod-{{ ai_gen_id }}">
                    <div class="ai-3d-slider-image-wrapper-{{ ai_gen_id }}">
                      {% if product.featured_image %}
                        <img
                          src="{{ product.featured_image | image_url: width: 600 }}"
                          alt="{{ product.featured_image.alt | escape }}"
                          class="ai-3d-slider-image-{{ ai_gen_id }}"
                          loading="lazy"
                          width="600"
                          height="600"
                        >
                      {% else %}
                        <div class="ai-3d-slider-placeholder-{{ ai_gen_id }}">
                          {{ 'product-1' | placeholder_svg_tag }}
                        </div>
                      {% endif %}
                    </div>
                    <div class="ai-3d-slider-reflection-{{ ai_gen_id }}"></div>
                  </div>
                  <div class="ai-3d-slider-info-{{ ai_gen_id }}">
                    <div class="ai-3d-slider-title-{{ ai_gen_id }}">{{ product.title }}</div>
                    <div class="ai-3d-slider-price-{{ ai_gen_id }}">{{ product.price | money }}</div>
                  </div>
                </a>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <div class="ai-3d-slider-nav-{{ ai_gen_id }}">
        <button class="ai-3d-slider-nav-btn-{{ ai_gen_id }}" data-prev aria-label="Previous slide">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        
        <div class="ai-3d-slider-dots-{{ ai_gen_id }}" data-dots></div>
        
        <button class="ai-3d-slider-nav-btn-{{ ai_gen_id }}" data-next aria-label="Next slide">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
    {% else %}
      <div class="ai-3d-slider-empty-{{ ai_gen_id }}">
        Add products to display in the 3D slider
      </div>
    {% endif %}
  </div>
</product-3d-slider-{{ ai_gen_id }}>

<script>
  (function() {
    class Product3DSlider{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.currentIndex = 0;
        this.slidesPerView = this.getSlidesPerView();
        this.touchStartX = 0;
        this.touchEndX = 0;
        this.isDragging = false;
      }

      connectedCallback() {
        this.track = this.querySelector('[data-track]');
        this.slides = Array.from(this.querySelectorAll('[data-slide]'));
        this.prevBtn = this.querySelector('[data-prev]');
        this.nextBtn = this.querySelector('[data-next]');
        this.dotsContainer = this.querySelector('[data-dots]');

        if (!this.track || this.slides.length === 0) return;

        this.totalSlides = this.slides.length;
        this.maxIndex = Math.max(0, this.totalSlides - this.slidesPerView);

        this.createDots();
        this.setupEventListeners();
        this.updateSlider();
        this.observeIntersection();

        window.addEventListener('resize', () => {
          this.slidesPerView = this.getSlidesPerView();
          this.maxIndex = Math.max(0, this.totalSlides - this.slidesPerView);
          this.currentIndex = Math.min(this.currentIndex, this.maxIndex);
          this.updateSlider();
        });
      }

      getSlidesPerView() {
        const width = window.innerWidth;
        if (width < 768) return 1;
        if (width < 1024) return 2;
        return 3;
      }

      createDots() {
        if (!this.dotsContainer) return;
        this.dotsContainer.innerHTML = '';
        
        const numDots = this.maxIndex + 1;
        for (let i = 0; i < numDots; i++) {
          const dot = document.createElement('div');
          dot.className = 'ai-3d-slider-dot-{{ ai_gen_id }}';
          dot.addEventListener('click', () => this.goToSlide(i));
          this.dotsContainer.appendChild(dot);
        }
      }

      setupEventListeners() {
        if (this.prevBtn) {
          this.prevBtn.addEventListener('click', () => this.prev());
        }
        
        if (this.nextBtn) {
          this.nextBtn.addEventListener('click', () => this.next());
        }

        this.track.addEventListener('touchstart', (e) => {
          this.touchStartX = e.changedTouches[0].screenX;
          this.isDragging = true;
        }, { passive: true });

        this.track.addEventListener('touchmove', (e) => {
          if (!this.isDragging) return;
          this.touchEndX = e.changedTouches[0].screenX;
        }, { passive: true });

        this.track.addEventListener('touchend', () => {
          if (!this.isDragging) return;
          this.handleSwipe();
          this.isDragging = false;
        });

        this.track.addEventListener('mousedown', (e) => {
          this.touchStartX = e.screenX;
          this.isDragging = true;
          e.preventDefault();
        });

        this.track.addEventListener('mousemove', (e) => {
          if (!this.isDragging) return;
          this.touchEndX = e.screenX;
        });

        this.track.addEventListener('mouseup', () => {
          if (!this.isDragging) return;
          this.handleSwipe();
          this.isDragging = false;
        });

        this.track.addEventListener('mouseleave', () => {
          if (!this.isDragging) return;
          this.isDragging = false;
        });
      }

      handleSwipe() {
        const swipeThreshold = 50;
        const diff = this.touchStartX - this.touchEndX;

        if (Math.abs(diff) > swipeThreshold) {
          if (diff > 0) {
            this.next();
          } else {
            this.prev();
          }
        }
      }

      prev() {
        if (this.currentIndex > 0) {
          this.currentIndex--;
          this.updateSlider();
        }
      }

      next() {
        if (this.currentIndex < this.maxIndex) {
          this.currentIndex++;
          this.updateSlider();
        }
      }

      goToSlide(index) {
        this.currentIndex = Math.max(0, Math.min(index, this.maxIndex));
        this.updateSlider();
      }

      updateSlider() {
        const slideWidth = this.slides[0].offsetWidth;
        const gap = 40;
        const offset = -(this.currentIndex * (slideWidth + gap));
        
        this.track.style.transform = `translateX(${offset}px)`;

        this.slides.forEach((slide, index) => {
          slide.classList.remove('active');
          if (index >= this.currentIndex && index < this.currentIndex + this.slidesPerView) {
            slide.classList.add('active');
          }
        });

        if (this.prevBtn) {
          this.prevBtn.disabled = this.currentIndex === 0;
        }
        
        if (this.nextBtn) {
          this.nextBtn.disabled = this.currentIndex >= this.maxIndex;
        }

        this.updateDots();
      }

      updateDots() {
        const dots = this.dotsContainer.querySelectorAll('.ai-3d-slider-dot-{{ ai_gen_id }}');
        dots.forEach((dot, index) => {
          dot.classList.toggle('active', index === this.currentIndex);
        });
      }

      observeIntersection() {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              this.slides.forEach((slide, index) => {
                setTimeout(() => {
                  slide.style.opacity = '1';
                  slide.style.transform = 'translateY(0)';
                }, index * 100);
              });
            }
          });
        }, { threshold: 0.1 });

        observer.observe(this);

        this.slides.forEach(slide => {
          slide.style.opacity = '0';
          slide.style.transform = 'translateY(30px)';
          slide.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        });
      }
    }

    customElements.define('product-3d-slider-{{ ai_gen_id }}', Product3DSlider{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "3D product slider",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "label": "Heading",
      "default": "Featured Products"
    },
    {
      "type": "product",
      "id": "product_1",
      "label": "Product 1"
    },
    {
      "type": "product",
      "id": "product_2",
      "label": "Product 2"
    },
    {
      "type": "product",
      "id": "product_3",
      "label": "Product 3"
    },
    {
      "type": "product",
      "id": "product_4",
      "label": "Product 4"
    },
    {
      "type": "product",
      "id": "product_5",
      "label": "Product 5"
    },
    {
      "type": "product",
      "id": "product_6",
      "label": "Product 6"
    },
    {
      "type": "header",
      "content": "3D effects"
    },
    {
      "type": "range",
      "id": "perspective",
      "label": "3D perspective",
      "min": 500,
      "max": 2000,
      "step": 100,
      "unit": "px",
      "default": 1200
    },
    {
      "type": "range",
      "id": "product_rotation",
      "label": "Product rotation",
      "min": -15,
      "max": 15,
      "step": 1,
      "unit": "deg",
      "default": 5
    },
    {
      "type": "range",
      "id": "product_tilt",
      "label": "Product tilt",
      "min": -10,
      "max": 10,
      "step": 1,
      "unit": "deg",
      "default": 3
    },
    {
      "type": "range",
      "id": "hover_tilt",
      "label": "Hover tilt",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "deg",
      "default": 5
    },
    {
      "type": "range",
      "id": "reflection_opacity",
      "label": "Reflection opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 30
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "slide_width",
      "label": "Slide width",
      "min": 250,
      "max": 500,
      "step": 10,
      "unit": "px",
      "default": 350
    },
    {
      "type": "range",
      "id": "pod_height",
      "label": "Pod height",
      "min": 250,
      "max": 500,
      "step": 10,
      "unit": "px",
      "default": 350
    },
    {
      "type": "range",
      "id": "pod_radius",
      "label": "Pod border radius",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#0a0e27"
    },
    {
      "type": "color",
      "id": "pod_color",
      "label": "Pod background",
      "default": "#1a1f3a"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent",
      "default": "#0066ff"
    },
    {
      "type": "color",
      "id": "shadow_color",
      "label": "Shadow",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "nav_button_color",
      "label": "Navigation button",
      "default": "#1a1f3a"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "heading_size",
      "label": "Heading size",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "product_title_size",
      "label": "Product title size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "price_size",
      "label": "Price size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "desktop_width_percent",
      "label": "Desktop width",
      "min": 50,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 100
    }
  ],
  "presets": [
    {
      "name": "3D product slider"
    }
  ]
}
{% endschema %}
