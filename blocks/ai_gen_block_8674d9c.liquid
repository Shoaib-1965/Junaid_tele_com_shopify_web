{% doc %}
  @prompt
    Create a testimonials section showing customer reviews in card-style slides. Each card displays the review text and a star rating (1 to 5 stars). The slider should auto-slide every 3 seconds with smooth transitions, include navigation arrows, and pause on hover. Allow manual addition and editing of testimonials via the CMS or theme editor. Use clean, modern design with subtle shadows and rounded corners. Fully responsive and mobile-friendly with smooth animations.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-testimonials-slider-{{ ai_gen_id }} {
    display: block;
    width: 100%;
    padding: 60px 20px;
    background-color: {{ block.settings.background_color }};
  }

  .ai-testimonials-container-{{ ai_gen_id }} {
    max-width: 1200px;
    margin: 0 auto;
  }

  .ai-testimonials-header-{{ ai_gen_id }} {
    text-align: center;
    margin-bottom: 40px;
  }

  .ai-testimonials-title-{{ ai_gen_id }} {
    font-size: {{ block.settings.title_size }}px;
    color: {{ block.settings.title_color }};
    margin: 0 0 10px;
  }

  .ai-testimonials-subtitle-{{ ai_gen_id }} {
    font-size: {{ block.settings.subtitle_size }}px;
    color: {{ block.settings.subtitle_color }};
    margin: 0;
  }

  .ai-testimonials-slider-wrapper-{{ ai_gen_id }} {
    position: relative;
    overflow: hidden;
    padding: 0 60px;
  }

  .ai-testimonials-track-{{ ai_gen_id }} {
    display: flex;
    transition: transform 0.5s ease-in-out;
  }

  .ai-testimonial-card-{{ ai_gen_id }} {
    min-width: 100%;
    padding: 40px;
    background-color: {{ block.settings.card_background }};
    border-radius: {{ block.settings.card_border_radius }}px;
    box-shadow: 0 4px 12px {{ block.settings.card_shadow_color }};
    text-align: center;
  }

  .ai-testimonial-stars-{{ ai_gen_id }} {
    display: flex;
    justify-content: center;
    gap: 4px;
    margin-bottom: 20px;
  }

  .ai-testimonial-star-{{ ai_gen_id }} {
    width: {{ block.settings.star_size }}px;
    height: {{ block.settings.star_size }}px;
    fill: {{ block.settings.star_color }};
  }

  .ai-testimonial-star-empty-{{ ai_gen_id }} {
    fill: {{ block.settings.star_empty_color }};
  }

  .ai-testimonial-text-{{ ai_gen_id }} {
    font-size: {{ block.settings.review_text_size }}px;
    color: {{ block.settings.review_text_color }};
    line-height: 1.6;
    margin-bottom: 20px;
  }

  .ai-testimonial-author-{{ ai_gen_id }} {
    font-size: {{ block.settings.author_size }}px;
    color: {{ block.settings.author_color }};
    font-weight: 600;
  }

  .ai-testimonials-nav-{{ ai_gen_id }} {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background-color: {{ block.settings.nav_background }};
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s ease;
    z-index: 10;
  }

  .ai-testimonials-nav-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.nav_hover_background }};
  }

  .ai-testimonials-nav-prev-{{ ai_gen_id }} {
    left: 0;
  }

  .ai-testimonials-nav-next-{{ ai_gen_id }} {
    right: 0;
  }

  .ai-testimonials-nav-{{ ai_gen_id }} svg {
    width: 20px;
    height: 20px;
    fill: {{ block.settings.nav_icon_color }};
  }

  .ai-testimonials-dots-{{ ai_gen_id }} {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 30px;
  }

  .ai-testimonials-dot-{{ ai_gen_id }} {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: {{ block.settings.dot_color }};
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .ai-testimonials-dot-{{ ai_gen_id }}.active {
    background-color: {{ block.settings.dot_active_color }};
  }

  @media screen and (max-width: 749px) {
    .ai-testimonials-slider-{{ ai_gen_id }} {
      padding: 40px 15px;
    }

    .ai-testimonials-slider-wrapper-{{ ai_gen_id }} {
      padding: 0 50px;
    }

    .ai-testimonial-card-{{ ai_gen_id }} {
      padding: 30px 20px;
    }

    .ai-testimonials-nav-{{ ai_gen_id }} {
      width: 35px;
      height: 35px;
    }

    .ai-testimonials-title-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.title_size }}px * 0.7);
    }

    .ai-testimonials-subtitle-{{ ai_gen_id }} {
      font-size: calc({{ block.settings.subtitle_size }}px * 0.85);
    }
  }
{% endstyle %}

<testimonials-slider-{{ ai_gen_id }}
  class="ai-testimonials-slider-{{ ai_gen_id }}"
  data-autoplay-interval="{{ block.settings.autoplay_interval }}"
  {{ block.shopify_attributes }}
>
  <div class="ai-testimonials-container-{{ ai_gen_id }}">
    {% if block.settings.section_title != blank or block.settings.section_subtitle != blank %}
      <div class="ai-testimonials-header-{{ ai_gen_id }}">
        {% if block.settings.section_title != blank %}
          <h2 class="ai-testimonials-title-{{ ai_gen_id }}">{{ block.settings.section_title }}</h2>
        {% endif %}
        {% if block.settings.section_subtitle != blank %}
          <p class="ai-testimonials-subtitle-{{ ai_gen_id }}">{{ block.settings.section_subtitle }}</p>
        {% endif %}
      </div>
    {% endif %}

    <div class="ai-testimonials-slider-wrapper-{{ ai_gen_id }}">
      <button
        class="ai-testimonials-nav-{{ ai_gen_id }} ai-testimonials-nav-prev-{{ ai_gen_id }}"
        aria-label="Previous testimonial"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
        </svg>
      </button>

      <div class="ai-testimonials-track-{{ ai_gen_id }}">
        {% for i in (1..5) %}
          {% liquid
            assign review_key = 'review_' | append: i
            assign author_key = 'author_' | append: i
            assign rating_key = 'rating_' | append: i

            assign review_text = block.settings[review_key]
            assign author_name = block.settings[author_key]
            assign rating = block.settings[rating_key]
          %}

          {% if review_text != blank %}
            <div class="ai-testimonial-card-{{ ai_gen_id }}">
              <div class="ai-testimonial-stars-{{ ai_gen_id }}">
                {% for star in (1..5) %}
                  <svg
                    class="ai-testimonial-star-{{ ai_gen_id }} {% if star > rating %}ai-testimonial-star-empty-{{ ai_gen_id }}{% endif %}"
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                  >
                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                  </svg>
                {% endfor %}
              </div>

              <p class="ai-testimonial-text-{{ ai_gen_id }}">{{ review_text }}</p>

              {% if author_name != blank %}
                <div class="ai-testimonial-author-{{ ai_gen_id }}">{{ author_name }}</div>
              {% endif %}
            </div>
          {% endif %}
        {% endfor %}
      </div>

      <button
        class="ai-testimonials-nav-{{ ai_gen_id }} ai-testimonials-nav-next-{{ ai_gen_id }}"
        aria-label="Next testimonial"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
        </svg>
      </button>
    </div>

    <div class="ai-testimonials-dots-{{ ai_gen_id }}"></div>
  </div>
</testimonials-slider-{{ ai_gen_id }}>

<script>
  (function() {
    class TestimonialsSlider{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.currentIndex = 0;
        this.autoplayTimer = null;
        this.isPaused = false;
      }

      connectedCallback() {
        this.track = this.querySelector('.ai-testimonials-track-{{ ai_gen_id }}');
        this.cards = this.querySelectorAll('.ai-testimonial-card-{{ ai_gen_id }}');
        this.prevButton = this.querySelector('.ai-testimonials-nav-prev-{{ ai_gen_id }}');
        this.nextButton = this.querySelector('.ai-testimonials-nav-next-{{ ai_gen_id }}');
        this.dotsContainer = this.querySelector('.ai-testimonials-dots-{{ ai_gen_id }}');
        this.autoplayInterval = parseInt(this.dataset.autoplayInterval) * 1000;

        if (this.cards.length === 0) return;

        this.createDots();
        this.setupEventListeners();
        this.startAutoplay();
      }

      createDots() {
        this.cards.forEach((card, index) => {
          const dot = document.createElement('button');
          dot.classList.add('ai-testimonials-dot-{{ ai_gen_id }}');
          dot.setAttribute('aria-label', 'Go to testimonial ' + (index + 1));
          if (index === 0) dot.classList.add('active');
          dot.addEventListener('click', () => this.goToSlide(index));
          this.dotsContainer.appendChild(dot);
        });
        this.dots = this.querySelectorAll('.ai-testimonials-dot-{{ ai_gen_id }}');
      }

      setupEventListeners() {
        this.prevButton.addEventListener('click', () => this.prevSlide());
        this.nextButton.addEventListener('click', () => this.nextSlide());

        this.addEventListener('mouseenter', () => this.pauseAutoplay());
        this.addEventListener('mouseleave', () => this.resumeAutoplay());
      }

      goToSlide(index) {
        this.currentIndex = index;
        this.updateSlider();
      }

      prevSlide() {
        this.currentIndex = this.currentIndex === 0 ? this.cards.length - 1 : this.currentIndex - 1;
        this.updateSlider();
        this.resetAutoplay();
      }

      nextSlide() {
        this.currentIndex = this.currentIndex === this.cards.length - 1 ? 0 : this.currentIndex + 1;
        this.updateSlider();
        this.resetAutoplay();
      }

      updateSlider() {
        const offset = -this.currentIndex * 100;
        this.track.style.transform = 'translateX(' + offset + '%)';

        this.dots.forEach((dot, index) => {
          if (index === this.currentIndex) {
            dot.classList.add('active');
          } else {
            dot.classList.remove('active');
          }
        });
      }

      startAutoplay() {
        if (this.autoplayInterval > 0) {
          this.autoplayTimer = setInterval(() => {
            if (!this.isPaused) {
              this.nextSlide();
            }
          }, this.autoplayInterval);
        }
      }

      pauseAutoplay() {
        this.isPaused = true;
      }

      resumeAutoplay() {
        this.isPaused = false;
      }

      resetAutoplay() {
        if (this.autoplayTimer) {
          clearInterval(this.autoplayTimer);
          this.startAutoplay();
        }
      }

      disconnectedCallback() {
        if (this.autoplayTimer) {
          clearInterval(this.autoplayTimer);
        }
      }
    }

    customElements.define('testimonials-slider-{{ ai_gen_id }}', TestimonialsSlider{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Testimonials slider",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Section"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Title",
      "default": "What Our Customers Say"
    },
    {
      "type": "text",
      "id": "section_subtitle",
      "label": "Subtitle",
      "default": "Real reviews from real customers"
    },
    {
      "type": "range",
      "id": "title_size",
      "label": "Title size",
      "min": 16,
      "max": 60,
      "step": 2,
      "unit": "px",
      "default": 36
    },
    {
      "type": "range",
      "id": "subtitle_size",
      "label": "Subtitle size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Subtitle color",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "Slider settings"
    },
    {
      "type": "range",
      "id": "autoplay_interval",
      "label": "Autoplay interval",
      "min": 1,
      "max": 10,
      "step": 1,
      "unit": "s",
      "default": 3
    },
    {
      "type": "header",
      "content": "Card style"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "label": "Border radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 16
    },
    {
      "type": "color",
      "id": "card_shadow_color",
      "label": "Shadow color",
      "default": "#00000015"
    },
    {
      "type": "range",
      "id": "review_text_size",
      "label": "Review text size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "color",
      "id": "review_text_color",
      "label": "Review text color",
      "default": "#333333"
    },
    {
      "type": "range",
      "id": "author_size",
      "label": "Author name size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "color",
      "id": "author_color",
      "label": "Author name color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Star rating"
    },
    {
      "type": "range",
      "id": "star_size",
      "label": "Star size",
      "min": 16,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "color",
      "id": "star_color",
      "label": "Star color",
      "default": "#FFD700"
    },
    {
      "type": "color",
      "id": "star_empty_color",
      "label": "Empty star color",
      "default": "#E0E0E0"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "color",
      "id": "nav_background",
      "label": "Arrow background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "nav_hover_background",
      "label": "Arrow hover background",
      "default": "#f0f0f0"
    },
    {
      "type": "color",
      "id": "nav_icon_color",
      "label": "Arrow icon color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "dot_color",
      "label": "Dot color",
      "default": "#cccccc"
    },
    {
      "type": "color",
      "id": "dot_active_color",
      "label": "Active dot color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Testimonial 1"
    },
    {
      "type": "textarea",
      "id": "review_1",
      "label": "Review text",
      "default": "Amazing product! Exceeded all my expectations. The quality is outstanding and customer service was excellent."
    },
    {
      "type": "text",
      "id": "author_1",
      "label": "Customer name",
      "default": "Sarah Johnson"
    },
    {
      "type": "range",
      "id": "rating_1",
      "label": "Rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 5
    },
    {
      "type": "header",
      "content": "Testimonial 2"
    },
    {
      "type": "textarea",
      "id": "review_2",
      "label": "Review text",
      "default": "Great experience from start to finish. Fast shipping and the product looks even better in person!"
    },
    {
      "type": "text",
      "id": "author_2",
      "label": "Customer name",
      "default": "Michael Chen"
    },
    {
      "type": "range",
      "id": "rating_2",
      "label": "Rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 5
    },
    {
      "type": "header",
      "content": "Testimonial 3"
    },
    {
      "type": "textarea",
      "id": "review_3",
      "label": "Review text",
      "default": "Highly recommend! The quality is top-notch and it arrived exactly as described. Will definitely order again."
    },
    {
      "type": "text",
      "id": "author_3",
      "label": "Customer name",
      "default": "Emily Rodriguez"
    },
    {
      "type": "range",
      "id": "rating_3",
      "label": "Rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 4
    },
    {
      "type": "header",
      "content": "Testimonial 4"
    },
    {
      "type": "textarea",
      "id": "review_4",
      "label": "Review text"
    },
    {
      "type": "text",
      "id": "author_4",
      "label": "Customer name"
    },
    {
      "type": "range",
      "id": "rating_4",
      "label": "Rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 5
    },
    {
      "type": "header",
      "content": "Testimonial 5"
    },
    {
      "type": "textarea",
      "id": "review_5",
      "label": "Review text"
    },
    {
      "type": "text",
      "id": "author_5",
      "label": "Customer name"
    },
    {
      "type": "range",
      "id": "rating_5",
      "label": "Rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 5
    }
  ],
  "presets": [
    {
      "name": "Testimonials slider"
    }
  ]
}
{% endschema %}
